<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Askbootstrap">
    <meta name="author" content="Askbootstrap">
    <!-- page name -->
    <title>'דוקו'</title>
    <!-- Favicon Icon -->
    <link rel="icon" type="image/png" href="img/favicon.png">
    <!-- Bootstrap core CSS-->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <!-- Custom styles for this template-->
    <link href="css/osahan.css" rel="stylesheet">
    <!-- Owl Carousel -->
    <link rel="stylesheet" href="vendor/owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="vendor/owl-carousel/owl.theme.css">

    <!-- Our links -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
        var imagePath1 = '';
        var userEmail1 = '';

        $(document).ready(function () {
            //localstorage for the orientation and data
            local = localStorage.getItem('thisTask');
            console.log('local: ', JSON.parse(local));
            TaskObj = JSON.parse(localStorage["thisTask"]);
            console.log(TaskObj);

            //Menus
            localN = localStorage.getItem('myName');
            console.log('local: ', JSON.parse(localN));
            myNameObj = JSON.parse(localStorage["myName"]);
            document.getElementById("myNameN1").innerHTML = myNameObj.name;
            document.getElementById("myNameN2").innerHTML = myNameObj.name;

            Showorientation();//orientation
            getDatelis(); //Bring the details from the local storage
            getDataT();  //POST - Group_Feedback Table
            showStudentsData(); //POST - Student table

            //סנן
            $('#apply').click(filingSubm);  
            
            //User image
            localUSER = localStorage.getItem('user');
            objManager = JSON.parse(localUSER);
            showDetalis(objManager);
        });

         //User image
        function showDetalis(objManager) {
            Id = objManager.Id;
            //שיניתי
            var url = "../api/Docu/GetDetails/" + Id;
            ajaxCall("GET", url, "", funcsuccess, funcerror);
        }

        function funcsuccess(data) {
            obj = data;
            userEmail1 = obj[0].Email;
            //שינתי
            ajaxCall('GET', '../api/Docu/getavatar/' + obj[0].Id_, '', getAvatarImageSuccess, getAvatarImageError)
        }
        function funcerror() { }
        function getAvatarImageSuccess(imagePath1) {
            src = imagePath1; // קיבלנו את הניתוב הארוך למיקום התמונה בשרת
            let arr = src.split('http://localhost:44328/') //למחוק כשמעלים לשרת זה מפצל את החלק של השרת סתם כדי שנראה שעובד
            $("#avatarImage").attr("src", '../' + arr[1] /*imagePath1*/); //בשרת אנחנו מכניסים במקום הניתוב את ה src
        }
        function getAvatarImageError(err) {
            console.log(err)
        }

        //orientation
        orientationSTR = "";
        function Showorientation() {
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-index.html'>בית</a></li>";
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-index.html'>" + TaskObj.ClassName + "' " + TaskObj.ClassNum + "</a></li>";
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-professions.html'>מקצועות</a></li>";
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-professions.html'>" + TaskObj.Profession + "</a></li>";
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-tasks.html'>מטלות</a></li>";
            orientationSTR += "<li class='breadcrumb-item'><a style='color: black' href='manager-tasks.html'>מטלה מספר " + TaskObj.Task.Num + "</a></li>";
            orientationSTR += "<li class='breadcrumb-item active' aria-current='page'><a href='manager-tasks.html'>הגשות</a></li>";
            document.getElementById("orientation").innerHTML = orientationSTR;
        }

        //Bring the details from the local storage
        function getDatelis() {
            document.getElementById("taskNum").innerHTML = TaskObj.Task.Num;
            diffDays1 = diffDays(TaskObj.Task.Date);
            document.getElementById("topic").innerHTML = TaskObj.Task.Topic;
            document.getElementById("restDate").innerHTML = diffDays1 +" ימים";
            if (diffDays1 == "מועד ההגשה עבר") {
                 document.getElementById("restDate").style.color = "red"
            }             
        }

        //GET - Group_Feedback Table
        //לראות אם לשנות לקונטרולר של הדוקו הרגיל 
        var classData;
        var allTeam = [];
        var count = 0;
        function getDataT() {
            classData =
                {
                    "ClassName": TaskObj.ClassName,
                    "ClassNum": TaskObj.ClassNum,
                    "Proffesion": TaskObj.Profession
                }
            apiT = "../api/Student/GetTeamData";
            ajaxCall("POST", apiT, JSON.stringify(classData), GETsuccess1, GETerror1)
        }
        function GETsuccess1(data) {
            details = data;
            numT = TaskObj.Task.Num; 
            for (var i = 0; i < details.length; i++) {
                if (details[i].IdTask == numT) {
                    count++;
                    allTeam.push(details[i]);
                }
                document.getElementById("teamNum").innerHTML = count;
            }        
             //
            //noHaveTeamId
            if (count == 0 || details.length == 0) {
                document.getElementById("noHaveTeamId").innerHTML = "הצוותים טרם העלו את הפתרון";
                document.getElementById("teamNum").innerHTML = count;
                 $('#apply').attr("disabled", true);
            }
        }
        function GETerror1(err) {
            console.log(err);
        }

        //View all details on the page
        var statusArr = ["טרם הועלה סרטון", "סרטון הועלה, מחכה לאישור", "סרטון הועלה ואושר לפרסום"];
        var waitingSTR = "";
        var approveSTR = "";  
        var notApprovedSTR = "";
        var allTeamSTR = "";
        var color = "";
        var status;
        var imgScore = "";
        var btnSorces = "";
        var strAll = [];
        function getWaiting() {
            waitingSTR = "";
            notApprovedSTR = "";
            allTeamSTR = "";
            approveSTR = "";
            imgScore = "";
            for (var i = 0; i < allTeam.length; i++) {
                if (allTeam[i].Status_ == 1 ) {
                    if ((allTeam[i].Grade == 0 || allTeam[i].Grade == null) && (allTeam[i].Feedback == "" || allTeam[i].Feedback == null)) {
                        imgScore = "img/NEW.png";
                        btnSorces = "giveScore(this)";                   
                    }
                    else {
                        imgScore = "img/ציון.png";
                        btnSorces = "ViewgiveScore(this)";         
                      }   
                    namesS = getNameS(allTeam[i].Group_students);

                        waitingSTR += "<div class='col-xl-4 col-sm-6 mb-3'>";
                        waitingSTR += "<div class='channels-card' style='padding: 24px 25px;'>";
                        waitingSTR += "<div class='text2' style='color: black; font-size:17px; text-align:right '>";
                        waitingSTR += "<div class='row'> צוות מספר &nbsp;";
                        waitingSTR += allTeam[i].GroupNum;
                        waitingSTR += " </div></div><div class='row'>";
                        waitingSTR += "<div class='channels-card' style='padding: 5px;background: #eceff0 none repeat scroll 0 0; box-shadow: 0 0 1px black;'>";
                        waitingSTR += "<div class='statuses-text'><h6 style='font-size: 20px;'>";
                        waitingSTR += namesS
                        waitingSTR += "</h6></div></div></div><div class='row'><div class='statuses-text'>";
                        waitingSTR += "סטאטוס: &nbsp;</div><div class='statuses-text' style='color:#ee8d14; font-size: 22px;'>";
                        waitingSTR += statusArr[1];
                        waitingSTR += "</div></div><div class='row' style='padding-right: inherit; display: block;'>";
                        waitingSTR += " <div class='channels-card-image'><a><img id='" + i + "' onclick='approveVidow(this)' class='img-fluid' src='img/approved1.png' alt='אישור הסרטון'>";
                        waitingSTR += "</a>&nbsp;<a><img id='" + i + "'onclick='" + btnSorces + "' class='img-fluid' src='" + imgScore + "' alt='משוב וציון'>";
                        waitingSTR += "</a>&nbsp;<a>";
                        waitingSTR += "<img onclick='showVideo(this)' id='" + i + "' class='img-fluid' src='img/WatchVideo.png' alt='צפיה בסרטון'>";
                        waitingSTR += "</a>&nbsp;";
                        waitingSTR += "<div id='headerPopup" + i + "' style='display:none' class='mfp-hide embed-responsive embed-responsive-16by9'>";
                        waitingSTR += " </div><br /></div></div></div></div>";
                    }
                }
                document.getElementById("waitingID").innerHTML = waitingSTR;
                strAll[1] = waitingSTR;
        }
        function getApprove() {
            approveSTR = "";  
            notApprovedSTR = "";  
            allTeamSTR = "";
            waitingSTR = "";
            imgScore = "";
            btnSorces = "";
            for (var i = 0; i < allTeam.length; i++) {
                if (allTeam[i].Status_ == 2) {
                    if ((allTeam[i].Grade == 0 || allTeam[i].Grade == null) && (allTeam[i].Feedback == "" || allTeam[i].Feedback == null)) {
                        imgScore = "img/NEW.png";
                        btnSorces = "giveScore(this)";
                        }
                    else {
                        imgScore = "img/ציון.png";
                        btnSorces = "ViewgiveScore(this)"; 
                    }
                    namesS=getNameS(allTeam[i].Group_students);
                    approveSTR += "<div class='col-xl-4 col-sm-6 mb-3'>";
                    approveSTR += "<div class='channels-card' style='padding: 24px 25px;'>";
                    approveSTR += "<div class='text2' style='color: black; font-size:17px; text-align:right '>";
                    approveSTR += "<div class='row'> צוות מספר &nbsp;";
                    approveSTR += allTeam[i].GroupNum;
                    approveSTR += " </div></div><div class='row'>";
                    approveSTR += "<div class='channels-card' style='padding: 5px;background: #eceff0 none repeat scroll 0 0; box-shadow: 0 0 1px black;'>";
                    approveSTR += "<div class='statuses-text'><h6 style='font-size: 20px;'>";
                    approveSTR += namesS;
                    approveSTR += "</h6></div></div></div><div class='row'><div class='statuses-text'>";
                    approveSTR += "סטאטוס: &nbsp;</div><div class='statuses-text' style='color:#1aaf10; font-size: 22px;'>";
                    approveSTR += statusArr[2];
                    approveSTR += "</div></div><div class='row' style='padding-right: inherit; display: block;'>";
                    approveSTR += " <div class='channels-card-image'><a><img id='" + i + "'onclick='CancleapproveVidow(this)' class='img-fluid' src='img/cancleBtn.png' alt='ביטול הסרטון'>";
                    approveSTR += "</a>&nbsp;<a><img id='"+i+"'onclick='"+btnSorces+"' class='img-fluid' src='"+imgScore+"' alt='משוב וציון'>";
                    approveSTR += "</a>&nbsp;<a>";
                    approveSTR += "<img onclick='showVideo(this)' id='"+i+"' class='img-fluid' src='img/WatchVideo.png' alt='צפיה בסרטון'>";
                    approveSTR += "</a>&nbsp;";
                    approveSTR += "<div id='headerPopup"+i+"' style='display:none' class='mfp-hide embed-responsive embed-responsive-16by9'>";
                    approveSTR += " </div><br /></div></div></div></div>";
                }   
            }
            document.getElementById("approveID").innerHTML = approveSTR;
            strAll[2] = approveSTR;
        }             
        function getNotApproved() {
            notApprovedSTR = "";  
            allTeamSTR = "";
            approveSTR = "";
            waitingSTR = "";
            for (var i = 0; i < allTeam.length; i++) {
                if (allTeam[i].Status_ == 0) {
                    if ((allTeam[i].Grade == 0 || allTeam[i].Grade == null) && (allTeam[i].Feedback == "" || allTeam[i].Feedback == null)) {        
                        imgScore = "img/NEW.png";
                        btnSorces = "giveScore(this)";
                        }
                    else {
                        imgScore = "img/ציון.png";
                        btnSorces = "ViewgiveScore(this)";
                        
                        
                    }
                   namesS=getNameS(allTeam[i].Group_students);
                    notApprovedSTR += "<div class='col-xl-4 col-sm-6 mb-3'>";
                    notApprovedSTR += "<div class='channels-card' style='padding: 24px 25px;'>";
                    notApprovedSTR += "<div class='text2' style='color: black; font-size:17px; text-align:right '>";
                    notApprovedSTR += "<div class='row'> צוות מספר &nbsp;";
                    notApprovedSTR += allTeam[i].GroupNum;
                    notApprovedSTR += " </div></div><div class='row'>";
                    notApprovedSTR += "<div class='channels-card' style='padding: 5px;background: #eceff0 none repeat scroll 0 0; box-shadow: 0 0 1px black;'>";
                    notApprovedSTR += "<div class='statuses-text'><h6 style='font-size: 20px;'>";
                    notApprovedSTR += namesS;
                    notApprovedSTR += "</h6></div></div></div><div class='row'><div class='statuses-text'>";
                    notApprovedSTR += "סטאטוס: &nbsp;</div><div class='statuses-text' style='color:red; font-size: 22px;'>";
                    notApprovedSTR += statusArr[0]; 
                    notApprovedSTR += "</div></div><div class='row' style='padding-right: inherit; display: block;'>";
                    notApprovedSTR += " <div class='channels-card-image'><a><img id='"+i+"' class='img-fluid' src='img/NOTapproved1.png' alt='אישור הסרטון'>";
                    notApprovedSTR += "</a>&nbsp;<a><img id='"+i+"'onclick='"+btnSorces+"' class='img-fluid' src='"+imgScore+"' alt='משוב וציון'>";

                    notApprovedSTR += "</a>&nbsp;<a>";
                    notApprovedSTR += "<img  id='"+i+"' class='img-fluid' src='img/NOTWatchVideo.png' alt='צפיה בסרטון'>";
                    notApprovedSTR += "</a>&nbsp;";
                    notApprovedSTR += "<div id='headerPopup"+i+"' style='display:none' class='mfp-hide embed-responsive embed-responsive-16by9'>";
                    notApprovedSTR += " </div><br /></div></div></div></div>";
                }   
            }
            document.getElementById("notApproved").innerHTML = notApprovedSTR;
            strAll[0] = notApprovedSTR;
        }      
        function getAllTeamID() {
            notApprovedSTR = "";  
            approveSTR = "";
            waitingSTR = "";
            imgScore = "";
            btnSorces = "";
            getWaiting();
            getApprove();
            getNotApproved();
            document.getElementById("allTeamID").innerHTML = strAll;
            
        }

        //Filing submissions
        function filingSubm() {
            //radio
            waitingToAppr = document.getElementById("waiting");
            approved = document.getElementById("approved");
            notApproved = document.getElementById("statuses_No");
            allstatus = document.getElementById("allstatus");
            //
            var Waiting = document.getElementById("showWaiting");
            var Approved = document.getElementById("showApproved");
            var NotApproved = document.getElementById("showNotApproved");
            var Allstatus = document.getElementById("show_num_sort");

            if (waitingToAppr.checked) {
                getWaiting();   
                if (Waiting.style.display === "none") {
                    Waiting.style.display = "block";
                    Allstatus.style.display = "none";
                    Approved.style.display = "none";
                    NotApproved.style.display = "none";
                }
                else {
                    Waiting.style.display = "none";
                    Allstatus.style.display = "none";
                    Approved.style.display = "none";
                    NotApproved.style.display = "none";
                }
            }
            if (approved.checked) {
                getApprove();
                if (Approved.style.display === "none") {
                    Approved.style.display = "block";
                    Allstatus.style.display = "none";
                    Waiting.style.display = "none";
                    NotApproved.style.display = "none";
                }
                else {
                    Approved.style.display = "none";
                    Allstatus.style.display = "none";
                    Waiting.style.display = "none";
                    NotApproved.style.display = "none";
                }
            }
            if (notApproved.checked) {
                getNotApproved();
                if (NotApproved.style.display === "none") {
                    NotApproved.style.display = "block";
                    Allstatus.style.display = "none";
                    Approved.style.display = "none";
                    Waiting.style.display = "none";
                }
                else {
                    NotApproved.style.display = "none";
                    Allstatus.style.display = "none";
                    Approved.style.display = "none";
                    Waiting.style.display = "none";
                }
            }
            if (allstatus.checked) {
                if (NotApproved.style.display === "none" || Approved.style.display === "none" || Waiting.style.display === "none") {
                    Allstatus.style.display = "block";
                    NotApproved.style.display = "none";
                    Approved.style.display = "none";
                    Waiting.style.display = "none";
                    getAllTeamID();
                }
                else {
                    NotApproved.style.display = "none";
                    Allstatus.style.display = "none";
                    Approved.style.display = "none";
                    Waiting.style.display = "none";
                }
            }

        }

        //The time difference
        function diffDays(subm) {
            console.log(subm);

            //today date
            var today = new Date();
            var day = today.getDate();
            var month = today.getMonth() + 1;    
            var year = today.getFullYear();
            var date2 = new Date(month + '/' + day + '/' + year);
            console.log(date2);
            //Task date
            var subm1 = subm.split('/');
            var dateVal = `${subm1[2]}/${subm1[1]}/${subm1[0]}` //M-D-Y
            var submission = new Date(dateVal);
            console.log(subm1);
            console.log(submission);

            //rest of the date
            const diffTime = Math.abs(submission - date2);
            const diffDays2 = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 

            console.log(diffTime + " milliseconds");
            console.log(diffDays2 + " days");

            if (diffDays2 < 0) {
                diffDays2 = "מועד ההגשה עבר";
                return diffDays2;
            }
            else {
                return diffDays2;
            }
            console.log(diffDays);
        }
        //
       
        //הכפתורים בכל צוות
        //PUT -  Group_Feedback table
        var status = "";
        var idTeamfromDB = "";
        var result;
        function approveVidow(idApp) {
            idTeamfromDB = "";
            Swal.fire({
                title: 'האם את/ה בטוח/ה?',
                text: "אישורך יביא לפרסום הסרטון!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#990099',
                //cancelButtonColor: '#d33',
                confirmButtonText: 'אני בטוח/ה',
                cancelButtonText: 'ביטול'
            }).then((result) => {              
                if (result.value) {
                    status = 2;
                    Swal.fire({
                        title: 'הצלחת!',
                        text: 'הסרטון התפרסם במועד ההגשה המתוכן',
                        icon: 'success',
                        confirmButtonColor: '#990099',
                        confirmButtonText: 'הבנתי',
                    })
                    idTeamfromDB = allTeam[idApp.id].id
                    dataPD =
                    {
                        "ClassName": TaskObj.ClassName,
                        "ClassNum": TaskObj.ClassNum,
                        "Proffesion": TaskObj.Profession,
                        "Status": status,
                        "Grade": allTeam[idApp.id].Grade,
                        "Feedback": allTeam[idApp.id].Feedback,
                        "Video":allTeam[idApp.id].Video,
                        "Comment": allTeam[idApp.id].Comment,
                    }
                    apiID = "../api/Docu/updateFBG/" + idTeamfromDB;
                    console.log(dataPD);
        //            ajaxCall("PUT", apiID, JSON.stringify(dataPD), approveVidowsuccess, approveVidowerror);
                }
            })   
        }
        function CancleapproveVidow(idApp) {
            idTeamfromDB = "";
            Swal.fire({
                title: 'האם את/ה בטוח/ה?',
                text: "הסרטון לא יפורסם!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#990099',
                //cancelButtonColor: '#d33',
                confirmButtonText: 'אני בטוח/ה',
                cancelButtonText: 'ביטול'
            }).then((result) => {              
                if (result.value) {
                    status = 1;
                    Swal.fire({
                        title: 'הצלחת!',
                        text: 'הסרטון לא יפורסם',
                        icon: 'success',
                        confirmButtonColor: '#990099',
                        confirmButtonText: 'הבנתי',
                    })
                    idTeamfromDB = allTeam[idApp.id].id
                    dataCancle =
                    {
                        "ClassName": TaskObj.ClassName,
                        "ClassNum": TaskObj.ClassNum,
                        "Proffesion": TaskObj.Profession,
                        "Status": status,
                        "Grade": allTeam[idApp.id].Grade,
                        "Feedback": allTeam[idApp.id].Feedback,
                        "Video":allTeam[idApp.id].Video,
                        "Comment": allTeam[idApp.id].Comment
                    }
                    apiID = "../api/Docu/updateFBG/" + idTeamfromDB;
                    console.log(dataCancle);
                //    ajaxCall("PUT", apiID, JSON.stringify(dataCancle), cancleVidowsuccess, cancleVidowerror);
                }
            })   
        }

        //PUT -  Group_Feedback table
        var grade = "";
        var feedback = "";
        var dataPD1;
        function giveScore(idSc) {
            idTeamfromDB = "";
            feedback = "";
            grade = "";
            (async () => {
                const { value: formValues } = await Swal.fire({
                    title: 'ציון ומשוב',
                    html: 'משוב- אנא כתבו משוב עבור הפתרון שהועלה' +
                        '<input id="swal-input1" class="swal2-input">' + 'ציון- העניקו ציון עבור הסרטון' +
                        '<input id="swal-input2" class="swal2-input">',
                    focusConfirm: false,
                    confirmButtonText: 'הבא',
                    confirmButtonColor: '#990099',
                    cancelButtonText: 'ביטול',
                    showCancelButton: true,
                    preConfirm: () => {
                        return [
                            document.getElementById('swal-input1').value,
                            document.getElementById('swal-input2').value        
                        ]
                    }
                })
                feedback = document.getElementById('swal-input1').value;
                grade = document.getElementById('swal-input2').value;
                idTeamfromDB = allTeam[idSc.id].id;
                    dataPD1 =
                    {
                        "ClassName": TaskObj.ClassName,
                        "ClassNum": TaskObj.ClassNum,
                        "Proffesion": TaskObj.Profession,
                        "Grade": grade,
                        "Feedback": feedback,
                        "Status": allTeam[idSc.id].Status_,
                        "Video":allTeam[idSc.id].Video,
                        "Comment":allTeam[idSc.id].Comment
                    }
                //if (feedback != "" || grade !="") {
                    

                //}
                if (formValues) {
                    students1 = allTeam[idSc.id].Group_students;
                    students = students1.split(',');

                     for (var j = 0; j < students.length; j++) {              
                         getObj(allTeam[idSc.id].id, students[j]);
                         console.log(allTeam[idSc.id].id, students[j]);
                    }   
                    apiID = "../api/Docu/updateFBG/" + idTeamfromDB;
                    console.log(dataPD1);
                    ajaxCall("PUT", apiID, JSON.stringify(dataPD1), giveScoresuccess, giveScoreerror);

                    Swal.fire({
                        title: 'לעדכונך',
                        text: JSON.stringify(formValues),
                        icon: 'success',
                        confirmButtonColor: '#990099',
                        //cancelButtonColor: '#d33',
                        confirmButtonText: 'המשך',             
                    })

                }
            })()

            
        }

        //POST -  Student table
        var studentList = "";   
        function showStudentsData() {
            obj2 =
                {
                    "ClassName": TaskObj.ClassName,
                    "ClassNum": TaskObj.ClassNum,
                }
            console.log(obj2);

            url = "../api/Docu/GetStudents";
            ajaxCall("POST", url, JSON.stringify(obj2), GETsuccessS, GETerrorS)
        }            
        function GETsuccessS(studentsData) {
            studentList = studentsData;
        }
        function GETerrorS(err) {
            console.log(err);
        }

        //PUT - Student table
        var avgStudent = "";
        var students = "";
        var thisTeam = "";
        function getAvg(Newgrade, num, oldgrade) {
            if (oldgrade == null) {
                oldgrade = 0;

            }
            return ((oldgrade + Newgrade) / num);
            
        }        
        function postGradeStudent(teamArr) {
            console.log(teamArr);
        //    for (var i = 0; i < teamArr.length; i++) {
                //oldAvg = teamArr[i].student.avg;
                oldAvg = teamArr.student.avg;
                newAvg = getAvg(grade, TaskObj.Task.Num, oldAvg);
                console.log(newAvg);
                for (var j = 0; j < studentList.length; j++) {
                    if (studentList[j].id == teamArr.student.rowDB) {
                        objStudent = {
                            "FName": studentList[j].FName,
                            "LName": studentList[j].LName,
                            "PhoneNum": studentList[j].PhoneNum,
                            "Email": studentList[j].Email,
                            "City": studentList[j].City,
                            "Address": studentList[j].Street,
                            "Id": studentList[j].Id_,
                            "Bday": studentList[j].Bday,
                            "ClassName": studentList[j].ClassName,
                            "ClassNum": studentList[j].ClassNum,
                            "Password": studentList[j].Password_,
                            "GPA": newAvg,
                            "Id_row": teamArr.student.rowDB,
                        } //id_row
                        console.log(objStudent);
                        urlGPA = "../api/Docu/updateStudent/" + teamArr.student.rowDB;
                       ajaxCall("PUT", urlGPA, JSON.stringify(objStudent), updateDsuccess, updateDerror);
                    }
                }
            //}                                                                                      
        }
        function updateDsuccess(data) {
            console.log(data);
        }
        function updateDerror(err) {
            console.log(err);
        }

        var strStudentName = "";   
        function getNameS(idS) {
            strStudentName = "• ";
            strStudentName1 = "";
            students = idS.split(',');              
            for (var j = 0; j < studentList.length; j++) {                    
                for (var m = 0; m < students.length; m++) {
                    if (students[m] == studentList[j].Id_) {
                        strStudentName += " " + studentList[j].FName + " " + studentList[j].LName + " • ";                   
                    }
                }            
            }
            console.log(strStudentName);
            return strStudentName;
        }

        var arrStudent = [];
        var obj3;
        function getObj(gn, idS) {
            console.log(idS);
                for (var i = 0; i < studentList.length; i++) {
                    if (studentList[i].Id_ == idS) {
                        obj3 =
                        {
                        "grupnum": gn,
                            "student": {
                                "id1" : idS,
                                "rowDB": studentList[i].id,
                                "avg": studentList[i].GPA,
                                 }
                        }
                    }
            } 
            if (obj3 == undefined) {
                alert("אין תלמיד כזה")
            }
            else {
                console.log(idS);
            arrStudent.push(obj3);  
            //postGradeStudent(arrStudent);
            postGradeStudent(obj3);
            }
            
        }

        //PUT - Group_Feedback Table
        //ViewgiveScore
        var answers = "";
        var avgS = "";
        function ViewgiveScore(idSc1) {
            idTeamfromDB = "";
            feedback = "";
            grade = "";
            const ipGrade =  allTeam[idSc1.id].Grade;
            const ipFeedb =  allTeam[idSc1.id].Feedback;
            const gF = "<span style='color: #990099'>משוב: </span>" + ipFeedb  + " <br />" + "<span style='color: #990099'>ציון: </span>" + ipGrade;
            Swal.fire({
                title: "ציון ומשוב",
                html: gF,
                focusConfirm: false,
                    confirmButtonText: 'לשינוי',
                    confirmButtonColor: '#990099',
                    cancelButtonText: 'חזרה',
                    showCancelButton: true,
            }).then((result) => {
                if (result.value) {
                    (async () => {
                const { value: formValues } = await Swal.fire({
                    title: 'ציון ומשוב',
                    html: 'משוב- אנא כתבו משוב עבור הפתרון שהועלה' +
                        '<input id="swal-input1" class="swal2-input">' + 'ציון- העניקו ציון עבור הסרטון' +
                        '<input id="swal-input2" class="swal2-input">',
                    focusConfirm: false,
                    confirmButtonText: 'הבא',
                    confirmButtonColor: '#990099',
                    cancelButtonText: 'ביטול',
                    showCancelButton: true,
                    preConfirm: () => {
                        return [
                            document.getElementById('swal-input1').value,
                            document.getElementById('swal-input2').value        
                        ]
                    }
                })
                feedback = document.getElementById('swal-input1').value;
                grade = document.getElementById('swal-input2').value;
                idTeamfromDB = allTeam[idSc1.id].id
                dataPD1 =
                    {
                        "ClassName": TaskObj.ClassName,
                        "ClassNum": TaskObj.ClassNum,
                        "Proffesion": TaskObj.Profession,
                        "Grade": grade,
                        "Feedback": feedback,
                        "Status": allTeam[idSc1.id].Status_,
                        "Video":allTeam[idSc1.id].Video,
                        "Comment":allTeam[idSc1.id].Comment
                            }
                apiID = "../api/Docu/updateFBG/" + idTeamfromDB;
                console.log(dataPD1);
        //        ajaxCall("PUT", apiID, JSON.stringify(dataPD1), giveScoresuccess, giveScoreerror);
                
                if (formValues) {
                    Swal.fire({
                        title: 'לעדכונך',
                        text: JSON.stringify(formValues),
                        icon: 'success',
                        confirmButtonColor: '#990099',
                        confirmButtonText: 'המשך',             
                    })
                }
            })()
                }
            })
        }
         
        var clip = "";
        function showVideo(btn) {
            id = btn.id;
            clip = "";
            let videoPath = `../${allTeam[id].Video}`;   
                var x = document.getElementById("headerPopup" + id);
            clip += `<video width="200" height="150" controls>
                                                    <source src='${videoPath}' type="video/avi">
                                                    <source src='${videoPath}' type="video/mp4">
                                                    Sorry, your browser doesn't support embedded videos.
                                                </video>`
            $('#headerPopup' + id).append(clip);
            console.log(videoPath);
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
            //}
            
        }

        function approveVidowsuccess(data) {
            afterUpdARR = data;
            setTimeout(reload, 2000); //מרפרש אחרי 2 שניות

        }
        function approveVidowerror(err) {
            alert(err);
        }
        function cancleVidowsuccess(data) {
            afterUpdARR = data;
           
            setTimeout(reload, 2000); //מרפרש אחרי 2 שניות

        }
        function cancleVidowerror(err) {
            alert(err);
        }
        function giveScoresuccess(data) {
            afterUpdARR = data;
           
            setTimeout(reload, 2000); //מרפרש אחרי 2 שניות
        }
        function giveScoreerror(err) {
            alert(err);
        }

        function reload() {
          document.location.reload();
        }
    </script>
</head>
<body id="page-top">
    <!-- top bar -->
    <nav class="navbar navbar-expand navbar-light bg-white static-top osahan-nav sticky-top">
        &nbsp;&nbsp;
        <br />
        <button class="btn btn-link btn-sm text-secondary order-1 order-sm-0" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button> &nbsp;&nbsp;
        <a class="navbar-brand mr-1" href="manager-index.html"><img class="imgMenu" alt="" src="img/logo.png"></a>
        <!-- Navbar Search -->
        <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-5 my-2 my-md-0 osahan-navbar-search">
        </form>
        <!-- Navbar -->
        <ul class="navbar-nav ml-auto osahan-right-navbar">
            <li class="nav-item mx-1 app">
                <a class="nav-link" href="https://www.facebook.com/MindCET/?tn-str=k*F">
                    <i class="fa fa-facebook-f" title="פייסבוק"></i>
                </a>
            </li>  &nbsp;
            <li class="nav-item mx-1 app">
                <a class="nav-link" href="https://www.instagram.com/mindcet/channel/">
                    <i class="fa fa-instagram" title="אינסטגרם"></i>
                </a>
            </li>  &nbsp;
            <li class="nav-item mx-1 app">
                <a class="nav-link" href="https://www.mindcet.org/">
                    <i class="fa fa-external-link" title="אתר אינטרנט"></i>
                </a>
            </li>  &nbsp;
            <li class="nav-item mx-1" style="border-right:1px solid rgba(0,0,0,.1)">
            </li>
            <li class="nav-item dropdown no-arrow osahan-right-navbar-user">
                <a class="nav-link dropdown-toggle user-dropdown-link" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <img alt="Avatar" id="avatarImage" src="img/user1.png">
                    <span id="myNameN1"> </span>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                    <a class="dropdown-item" href="account.html"><i class="fas fa-fw fa-user-circle"></i> &nbsp; החשבון שלי</a>
                    <a class="dropdown-item" href="manager-settings.html"><i class="fas fa-fw fa-cog"></i> &nbsp; הגדרות</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal"><i class="fas fa-fw fa-sign-out-alt"></i> &nbsp; יציאה מהמערכת</a>
                </div>
            </li>
        </ul>
    </nav>

    <!-- orientation bar -->
        <nav class="navbar navbar-expand navbar-light bg-white static-top osahan-nav sticky-top" style="top: 70px;">
            <ol class="breadcrumb" id="orientation">
            </ol>
        </nav>
        <div id="wrapper">
            <!-- Sidebar -->
            <!-- Left menu -->
            <ul class="sidebar navbar-nav" style="z-index: 0;">
                <li class="nav-item ">
                    <a class="nav-link" href="manager-index.html">
                        <i class="fas fa-fw fa-home"></i>
                        <span>בית</span>
                    </a>
                </li>
                <li class="nav-item channel-sidebar-list">
                    <h6 id="myNameN2" class="nav-item">מנהל מערכת</h6>
                </li>
                <li class="nav-item dropdown ">
                    <a class="nav-link dropdown-toggle" href="" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-fw fa-folder"></i>
                        <span>יצירה</span>
                    </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item " href="manager-createNewClass.html">✎ הקמת כיתה חדשה</a>
                        <a class="dropdown-item" href="manager-createNewTeacher.html">✎ יצירת מורה חדש</a>
                        <a class="dropdown-item" href="manager-createNewStudent.html">✎ יצירת תלמיד חדש</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-fw fa-folder"></i>
                        <span>ניהול</span>
                    </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="manager-teacher-Management.html">📝 ניהול מורים</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="manager-index.html">
                        <i class="fas fa-fw fa-users"></i>
                        כיתות
                    </a>
                </li>
                <li class="nav-item channel-sidebar-list">
                    <h6 class="nav-item">פרטיות</h6>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="manager-settings.html">
                        <i class="fa fa-gear"></i>
                        <span>הגדרות</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="manager-login.html" data-toggle="modal" data-target="#logoutModal">
                        <i class="fa fa-sign-out" style="font-size:24px"></i>
                        <span>יציאה מהמערכת</span>
                    </a>
                </li>
            </ul>
            <!-- END Left menu -->
            <!-- Page content -->
            <div id="content-wrapper">
                <div class="container-fluid pb-0">
                    <div class="row text2">
                        <div class="col-lg-12 col-sm-11 col-xs-3 ">
                            <div class="row">
                                <span style="border-bottom: 1px solid #990099">
                                    סטאטוס הגשה - מטלה מספר &nbsp;
                                </span>
                                <div id="taskNum" style="border-bottom:1px solid #990099">
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="row">
                        <div class="col-lg-5 col-sm-5 text2">
                            <div class="row">
                                <span>
                                    נושא:&nbsp;
                                </span>
                                <div class="create-text" id="topic">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-sm-4 text2">
                            <div class="row">
                                <span>
                                    ימים להגשה:&nbsp;
                                </span>
                                <div class="create-text" id="restDate">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6 text2">
                            <div class="row">
                                <span>
                                    מספר צוותים:&nbsp;
                                </span>
                                <div class="create-text" id="teamNum">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- אין מטלות -->
                    <div class="row text2" style="color:red;font-size: 45px;text-align: center;">
                        <div class="col-md-12" id="noHaveTeamId">
                        </div>
                    </div>
                    <br /><hr class="mt-0">
                    <div class="row">
                        <h6 class="text2">
                            בחירת אפשרות הסינון:
                        </h6>
                    </div>
                    <div class="row">
                        <!-- העלו מטלה -->
                        <div class="col-lg-5 col-sm-12">
                            <input id="statuses_yes" class="text2" name="status" type="radio">
                            <label for="statuses_yes" class="create-text">
                                צוותים שהעלו את המטלה
                            </label>
                            <div class="statuses_yes-disclosure">
                                <input type="radio" id="waiting" name="taskApproved" value=" סרטונים שטרם אושרו לפרסום" style="margin-right: 1.5em">
                                <label class="statuses_yes create-text" for="taskApproved">
                                    סרטונים שטרם אושרו לפרסום
                                </label>
                                <br />
                                <input type="radio" id="approved" name="taskApproved" value="סרטונים מאושרים" style="margin-right: 1.5em">
                                <label class="statuses_yes create-text" for="grade">
                                    סרטונים מאושרים
                                </label>
                            </div>
                        </div>
                        <!-- לא העלו מטלה -->
                        <div class="col-lg-4 col-sm-12">
                            <input id="statuses_No" name="status" type="radio" value="צוותים שלא העלו את המטלה">
                            <label for="statuses_No" class="create-text">
                                צוותים שלא העלו את המטלה
                            </label>
                        </div>
                        <div class="col-lg-2 col-sm-6">
                            <input id="allstatus" name="status" type="radio">
                            <label for="allstatus" class="create-text">
                                הצג הכל
                            </label>
                        </div>
                        <div class="col-lg-1 col-sm-6">
                            <button id="apply" class="create-btn" style="width: 40px;">
                                סנן
                            </button>
                        </div>
                    </div>
                    <br />
                    <div class="row" id="show_num_sort" style="display:none">
                        <div class="row" id="allTeamID">

                        </div>
                    </div>
                    <div class="row" id="showApproved" style="display:none">
                        <div class="row" id="approveID">

                        </div>
                    </div>
                    <div class="row" id="showWaiting" style="display:none">
                        <div class="row" id="waitingID">

                        </div>
                    </div>
                    <div class="row" id="showNotApproved" style="display:none">

                        <div class="row" id="notApproved">

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#wrapper -->
        <!--<script src="js/showItem.js"></script>-->
        <!-- Scroll to Top Button-->
        <a class="scroll-to-top rounded" href="#page-top">
            <i class="fas fa-angle-up"></i>
        </a>
        <!-- Logout Modal-->
        <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">יצאת מהחשבון </h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body" style="font-size: 17px;">לחצו על "יציאה" כדי להתנתק מהמערכת</div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">ביטול</button>
                        <a class="btn btn-primary" href="manager-login.html">יציאה</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bootstrap core JavaScript-->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <!-- Core plugin JavaScript-->
        <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
        <!-- Owl Carousel -->
        <script src="vendor/owl-carousel/owl.carousel.js"></script>
        <!-- Custom scripts for all pages-->
        <script src="js/custom.js"></script>

</body>
</html>